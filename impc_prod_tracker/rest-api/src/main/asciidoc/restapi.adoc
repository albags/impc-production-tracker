= GenTaR REST API
v{version}, {date}
:doctype: book
:icons: font
:source-highlighter: highlightjs
:highlightjs-theme: github
:toc: left
:toclevels: 3
:sectlinks:
:sectnums:

[introduction]
== Introduction

GenTaR is designed to coordinate the production of transgenic mice between high-throughput
mouse production facilities and consortia of clinicians and human geneticists
while minimizing the overlap	and	maximizing	efficiencies. GenTaR captures the intention	of
a particular consortium	to produce mutant mice on a	particular	gene, the	progress	of
mouse	production	and	modified mutation creation on the	original mouse,	and	the	capture
of	phenotype	data	on	the	mouse.

This is a secure resource that can house various types of mutations linked to genes,
and will provide different data access policies to users.

This guide is aimed at developers of such applications.

== Usage of HTTP Verbs

The following table describes how the coderadar API interprets the HTTP verbs.

.HTTP Verbs
|===
|HTTP Verb | Usage

|GET
|GET is used to retrieve information without changing the state of the system.

|POST
|POST is used to submit an entity to the specified resource, often causing a change in state or side effects on the system.

|PUT
|PUT method replaces all current representations of the target resource with the request payload.

|===



== Authentication
anchor:login[]
A user has to log in to use other endpoints.
If the log in is successful, user obtains a JSON Web Token https://jwt.io

How to use the tokens is described in <<authentication, Authentication>>

===== Login Data Structure
include::{snippets}/auth/signin/request-fields.adoc[]

===== Example Request
include::{snippets}/auth/signin/http-request.adoc[]

===== Example Response
include::{snippets}/auth/signin/http-response.adoc[]

===== Response Structure
include::{snippets}/auth/signin/response-fields.adoc[]

==== Errors
===== Error when user/password is incorrect:
When trying to sign in with an incorrect user/password the system will inform about it returning
an error message.

.request
include::{snippets}/auth/signin/no-valid-user-password/http-request.adoc[]

.response
include::{snippets}/auth/signin/no-valid-user-password/http-response.adoc[]


==== Authentication
After a user registered, he or she can start working with iMits2.
The first step is login. To log in in iMits2 use the <<login, Login>> endpoint. The user must use the username and the password
specified at registration. If the login was successful user gets a JSON Web Token (see https://jwt.io):

After that the user has to use the access token for authentication with each request to a protected route or resource.
The tokens are signed by the server so the server can validate the signature of the token to grant the access to resources.
The access token is a Base64 encoded String, that must be added to Authorization HTTP header like this:

 Authorization: Bearer eyJhbGciOiJSUzI1NiJIUzI1NiJ9.eyJpc3MiOiJjb2RlcmFkYXIiLCJleHAiOjE0ODQ1MTUzOTUsInR5cGUiOiJSRUZSRVNIIiwiaWF0IjoxNDg0NTE1NDU1LCJ1c2VySWQiOiIxIiwidXNlcm5hbWUiOiJyYWRhciJ9.zfkyc5jkPiAUEt7nU25SJxKprcPiXaiq0Q6bCJ_RrQo

The access token is short-lived and by default expires after 30 minutes.

A typical work flow looks like this:

. Client logs in with username and password and gets one token
. Client requires resources using the access token in each request
. After 30 minutes client gets a 401-Response
. Clients logs in again and gets a new token

See more: https://auth0.com/docs/tokens/refresh-token and https://auth0.com/blog/refresh-tokens-what-are-they-and-when-to-use-them/



== Projects
anchor:chapter-configure[]
This section describes the REST endpoints for projects in the system.

A project in GenTaR is the container for the intention and has one or more plans with the attempt
information.

=== Fields
These are the fields you are going to see in the body of a request in a GET or in the payload for POST or PUT
operations.
include::{snippets}/projects/getProject/response-fields.adoc[]

=== Filters
When you use the endpoint to get all the projects, you can also use filters to reduce the results.
This is the list of filters you can use:

.Filters for projects
|===
|Filter name | Description

|tpns
|TPN(s) to be used as a filter. Eg: TPN:000000013.

|intentions
a|Name of the intention. Possible values:

- Point Mutation
- Deletion
- Exon Deletion
- Intra-exon deletion
- Inter-exon deletion
- Whole-gene deletion
- Copy Number Variant
- SNP
- Insertion
- Inverted insertion
- Inversion
- Indel
- Complex rearrangement

|genes
|Marker symbol or accession id(s). Eg.Vps37a,MGI:1261835

|workUnitNames
|Name of the work unit(s) associated with any of the plans in the project.

|workGroupNames
|Name of the work group(s) associated with any of the plans in the project.

|assignmentNames
a|Assignment Name. Possible values:

* Assigned
* Inspect - Conflict
* Inactive
* Abandoned
* Inspect - Attempt
* Inspect - GLT Mouse

|summaryStatusNames
|Summary Status of the project. Eg: Plan Created.

|privacyNames
|The privacy of the project. Any of: public, protected, restricted.

|externalReferences
|External reference for the project.

|imitsMiPlanIds
|Ids in iMits (if the project was migrated from there).

|===

=== GET
==== Get a specific project

This endpoint shows a project in the system.

===== Example Request

Curl:
include::{snippets}/projects/getProject/curl-request.adoc[]

===== Example Response

include::{snippets}/projects/getProject/http-response.adoc[]


==== Get all Projects
This endpoint shows all the projects the user has permission to see.

===== Example Request

Curl:
include::{snippets}/projects/allProjects/curl-request.adoc[]

===== Example Response

include::{snippets}/projects/allProjects/http-response.adoc[]

==== Get all Projects using filters.

You can also apply filters to the endpoint to refine the search. This is a list of the filters you can
use. Each filter admits several values separated by comma.



===== Example Request

Curl:
include::{snippets}/projects/allProjectsWithFilter/http-request.adoc[]

===== Example Response

include::{snippets}/projects/allProjectsWithFilter/http-response.adoc[]

=== POST

==== Create a project

In order to create a project, it's necessary to create also a plan attached to it.

===== Example Request

Curl:
include::{snippets}/projects/postProject/http-request.adoc[]

===== Example Response

include::{snippets}/projects/postProject/http-response.adoc[]

===== Fields in Response
include::{snippets}/projects/postProject/response-fields.adoc[]





