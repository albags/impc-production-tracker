language: java

dist: xenial

env:
  global:
    - DOCKER_COMPOSE_VERSION=1.23.2
    - secure: "myq9lhx0+X3u0cf1sZnRQRJteDqiupAQD8+KfEPMHja+i0VzH2hitlr++lvNcKqjm+4R0JlP61ofB+oRiBQ6O9liJGpZ+VtpXakqqUqtoLLORmXeE2hVGOGxK76k7l7lxPQ32NkMI7yRjG//CjIcGLaXUM2su8FY1gXAIgyL+YwXuEHJvS4/49dvR+oZoHDCQWocSzpBtYB5WFux3x9VQSwdrjsthWiyOz79fptpmrJMkoLGISDOGS/V4TQGb6bKP6vb9EjvBFavVez53eeUahBeyeaHybiszmKu1kJ/CKNzhwhyx0qhWZmcH3uTKVRewoQY8lGSlRJ5n/XlXRXuLO6wwBMYtj1PMu1TyFGvLNttfgBdGwDez5btHUmiWidH/QkJWgD02l1xiHJfNiYQUPB+SknAEd+VK6oaHrX3BpukCKKXkuLrxqjldP8cBgpype3Lx9nqg7svcJz/wPH995VR3ZpejTwv0O7DqNC/j1shApgp2VcJpW7gDkjm79DHUKpAkIXCUuhr0sOk02VqYMcOmwRa/KustAeM1iKaMOcVQfZXsP2016h1ZJElVUcyES78bXCvP2stNPo01oFYPLkLf2cfbUwmhXmmRSyZ2IA8NDal5PXHj1MpsnwJbOk56DweqD5ZwwPaUuGWz8G+i88SlaCBrQnxW7Xmod3LgsI="
    - secure: "agoRe8UTaYlmntG+/XDlcW9fzHUtHxy2U0klqw0BI1LCweWCLo5LL/L/trxJooTcAjk8gqkls+bQYglGp7fsEKTM7RQ/HRd52+dBIAx6KZ7aue+Z5N/EqR0XkZYjzq9SDllbTqZmBT/9wwt9tq7yZTiepNtsPnJgLr9rUFdzi5is94iS4KnwNwAm9gMiPRMrNeCDxnbXOtzoS4BMAlNBPbFuBLiCv7EeuZGcHD5ChiNgQMLwteJMgiangL3+fh0105rv7+almaTWkeYIMUs/3MvexOvp+WrKE0ZegZFvhhHlrl1+fiHkQNrmlco5kk955KufPICgap/fb+EMFr0qD6CbFohY3N+OgFebuxXuQx8E+zZXPsMmGM1qTaDQ7zT1lU74ELVUUCTkdZuQvNHDt43945aVyQlRI7I7uhE2ud903Rna77bqKYZ4L+3nlYiywFQT4Ag86TLJsnUPadKss2QnjFjAGl84XEHKocyKBZmkwu7ddDosiF4iPC2sIZX0DgFMJja2ycWQ4ctm0veSwfhqBTIs7L9nO6dTi3XHQ00l2ayUM18yqhvqG7/ff+6/0ZxI53zyESKILtl/3vc/3CVvb+uQ/7h9ifhp1xH6quhtJrTo/E6D6umlMKm2yHzT/tGfF95+yqJPETyKFbTOMhBraKfL9UohMurcALAMhZo="
    - secure: "eylpzAmf6mBZ10Vuada8RR8uaeDeGd2t1A4XQMRR3+vcwPJU88Ng2TRleG051AYke0NBbJUKl1A2GRr+k90W+9AKhga7ybaQkIu0JKk8O7fpmc7A2XsCwlAAK0kkJ0nGpZWiRzC9zJ0OQ06rENPZQRRg6bdSUgeq5GvlN+8a4AxpFfvWiqh7kXIgDG6Qe4tDRA1ou2wGypK955FU5ik0gh0bktebOd+hWTmhtnmF9zXUaLXB1MSVygZlhpwlkmZAxzegofa/GztY6cc2Y+jlZr+imhFCL7sKctYqJvvKC8HBxKQ6JOJdZyX+pAxq5HuAgTsHXCN96ZEl6NmQL2AVlvQDMj1ibUQdHkZ3PNYddc+ZESTxV1lrAs3/JVfEmc8YUnuBqg9MRkZmI97RHNwinlWdo+vs6hGTNC1IoZL5sqSrtaLJwtU7Ii6BLWZY9G0oKIUV1Dy2G4g3FRnxh4PAE6SctRAKxcQ+FXXKrmmP9zOlloXOyuGd4uf+UKlo0x8eeuNph2bVZTZ36aYCiCcldk2ZDzKiHT0sYWKQva+8tEGBXGAiTV1T0wdCoyRaEYpB8sMStnQhasURWVEahzRTUuo8qIEK4kYG756kGdcyt6BbPViw4AC9nUCcj66vG78Tsj4vKuL4/zAdM7PBf2KvaTtuTMSVfrWF1HW+WwMm8Qo="
  
before_install:
  - curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
  - sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable"
  - sudo apt-get update
  - sudo apt-get -y -o Dpkg::Options::="--force-confnew" install docker-ce
  
  - sudo rm /usr/local/bin/docker-compose
  - curl -L https://github.com/docker/compose/releases/download/${DOCKER_COMPOSE_VERSION}/docker-compose-`uname -s`-`uname -m` > docker-compose
  - chmod +x docker-compose
  - sudo mv docker-compose /usr/local/bin  

jdk: oraclejdk11
      
services:
  - docker

script: 
  -   cd impc_prod_tracker
  -   mvn clean test


after_success:
  - if [ "$TRAVIS_BRANCH" == "master" ] && [ "$TRAVIS_REPO_SLUG" == "mpi2/impc-production-tracker" ]; then
        cd $TRAVIS_BUILD_DIR;
        docker-compose build;
        docker tag impc-production-tracker_prod_tracker:latest "$DOCKER_USERNAME"/"$DOCKER_REPO":$(git rev-parse --short HEAD);
        docker login -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD";
        docker push "$DOCKER_USERNAME"/"$DOCKER_REPO":$(git rev-parse --short HEAD);
        docker logout;
    fi
